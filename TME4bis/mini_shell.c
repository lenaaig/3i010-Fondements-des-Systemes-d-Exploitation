#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <string.h>
#include <sys/time.h>
#include <sys/times.h>
#include <sys/resource.h>
#include <sys/wait.h>
#include <math.h>

int main(int argc, char * argv[]){
	int attendre=0, retour,i;
	struct rusage r;
	char *chaine = (char*) malloc(sizeof(char)*100);	
	printf("Entrer votre commande (coller le & Ã  la commande):\n");
	scanf("%100[^\n]",chaine);
	
	if(chaine[strlen(chaine)-1] == '&'){
		attendre=1;
		chaine[strlen(chaine)-1]='\0';
	}

	//Argument:
	int nbarg=atoi(argv[1])+1;
	char * arg[nbarg+1];
	arg[0] = strtok(chaine," ");
	for (i=1; i<nbarg; i++){
		arg[i] = strtok(NULL," ");
	}
	arg[nbarg]=NULL;

	//printf("\n _%s_ \n",chaine);
	if(fork() == 0){
		execvp(chaine, arg);
		exit(1);//En cas d'erreur	
	}

	if(attendre == 0){
		wait(&retour);  
	}
	
	//Times des fils du processus pere:
	getrusage(RUSAGE_CHILDREN,&r);
	time_t childUserSec = r.ru_utime.tv_sec;
 	time_t childUserMs= r.ru_utime.tv_usec;
  	time_t childSysSec = r.ru_stime.tv_sec;
  	time_t childSysMs = r.ru_stime.tv_usec;
 	printf("Children User: %d sec, %d ms\n",childUserSec,childUserMs);
 	printf("Children System: %d sec, %d ms\n",childSysSec ,childSysMs);


	free(chaine);
	
	return 0;
}
