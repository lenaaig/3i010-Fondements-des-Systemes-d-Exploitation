#include <stdio.h>
#include <stdlib.h>
#include <sys/times.h>
#include <time.h>
#include <math.h>
#include <unistd.h>
#include <sys/types.h>

void lance_commande(char *commande){
	struct timeval tv1,tv2;
	gettimeofday(&tv1, NULL);
	int res = system(commande);
	gettimeofday(&tv2, NULL);
	if (res==-1)
		printf("Erreur de commande \n");
	float exec=(tv2.tv_sec - tv1.tv_sec)+(tv2.tv_usec - tv1.tv_usec)*pow(10,-6);
	printf("Temps mis par l'execution = %f s\n", exec );
}


void lance_commande2(char *commande){
	struct tms buf1, buf2;
	struct timeval tv1, tv2;

	gettimeofday(&tv1, NULL);
	times(&buf1);
	int res = system(commande);
	gettimeofday(&tv2, NULL);
	times(&buf2);

	if (res==-1)
		printf("Erreur de commande \n");
	float exec=(tv2.tv_sec - tv1.tv_sec)+(tv2.tv_usec - tv1.tv_usec)*pow(10,-6);
	printf("%d \n",getpid());
	printf("Statistiques de %s\n", commande);
	printf("Temps total : \t\t %f \n",exec);
	printf("Temps utilisateur : \t %Lf \n",(long double)(buf2.tms_utime-buf1.tms_utime)/(long double)(sysconf(_SC_CLK_TCK)));
	printf("Temps systeme : \t %Lf \n",(long double)(buf2.tms_stime-buf1.tms_stime)/(long double)sysconf(_SC_CLK_TCK));
	printf("Temps util. fils : \t %Lf \n",(long double)(buf2.tms_cutime-buf1.tms_cutime)/(long double)sysconf(_SC_CLK_TCK));
	printf("Temps sys. fils : \t %Lf \n",(long double)(buf2.tms_cstime-buf1.tms_cstime)/(long double)sysconf(_SC_CLK_TCK));
}

int main (int argc, char *argv[]){

	if (argc < 2){
		printf("Il faut entrer une commande \n");
		exit(0);	
	}
	int i;
	for (i=1; i<argc;i++){
		lance_commande2(argv[i]);
	}

	return 0;
}
